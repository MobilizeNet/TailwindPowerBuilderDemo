{"ast":null,"code":"import { ChartElement, BoxElement, Box, TextBox, FloatElement } from '../../core';\nimport LegendLayout from './legend-layout';\nimport LegendItem from './legend-item';\nimport { TOP, RIGHT, BOTTOM, LEFT, CENTER, X, Y, BLACK } from '../../common/constants';\nimport { deepExtend, defined, getTemplate, getSpacing, inArray, setDefaultOptions } from '../../common';\nconst HORIZONTAL = \"horizontal\";\nconst POINTER = \"pointer\";\nconst CUSTOM = \"custom\";\n\nclass Legend extends ChartElement {\n  constructor(options, chartService = {}) {\n    super(options);\n    this.chartService = chartService;\n\n    if (!inArray(this.options.position, [TOP, RIGHT, BOTTOM, LEFT, CUSTOM])) {\n      this.options.position = RIGHT;\n    }\n\n    this.createContainers();\n    this.createLegendTitle(options.title);\n    this.createItems();\n  }\n\n  createContainers() {\n    const options = this.options;\n    const {\n      position,\n      align: userAlign\n    } = options;\n    let align = position;\n    let vAlign = CENTER;\n\n    if (position === CUSTOM) {\n      align = LEFT;\n    } else if (inArray(position, [TOP, BOTTOM])) {\n      if (userAlign === \"start\") {\n        align = LEFT;\n      } else if (userAlign === \"end\") {\n        align = RIGHT;\n      } else {\n        align = CENTER;\n      }\n\n      vAlign = position;\n    } else if (userAlign) {\n      if (userAlign === \"start\") {\n        vAlign = TOP;\n      } else if (userAlign === \"end\") {\n        vAlign = BOTTOM;\n      }\n    }\n\n    this.container = new BoxElement({\n      margin: options.margin,\n      padding: options.padding,\n      background: options.background,\n      border: options.border,\n      vAlign: vAlign,\n      align: align,\n      zIndex: options.zIndex,\n      shrinkToFit: true\n    });\n\n    if (this.hasTitle()) {\n      this.itemsContainer = new BoxElement({\n        vAlign: vAlign,\n        align: align,\n        zIndex: options.zIndex,\n        shrinkToFit: true\n      });\n    } else {\n      this.itemsContainer = this.container;\n    }\n\n    this.append(this.container);\n  }\n\n  createItems() {\n    const chartService = this.getService();\n    const options = this.options;\n    const vertical = this.isVertical();\n    const innerElement = new LegendLayout({\n      vertical: vertical,\n      spacing: options.spacing,\n      rtl: chartService.rtl\n    }, chartService);\n    let items = options.items;\n\n    if (options.reverse) {\n      items = items.slice(0).reverse();\n    }\n\n    const count = items.length;\n\n    for (let i = 0; i < count; i++) {\n      let item = items[i];\n      innerElement.append(new LegendItem(deepExtend({}, {\n        markers: options.markers,\n        labels: options.labels,\n        rtl: chartService.rtl\n      }, options.item, item)));\n    }\n\n    innerElement.render();\n    this.itemsContainer.append(innerElement);\n  }\n\n  isVertical() {\n    const {\n      orientation,\n      position\n    } = this.options;\n    const vertical = position === CUSTOM && orientation !== HORIZONTAL || (defined(orientation) ? orientation !== HORIZONTAL : inArray(position, [LEFT, RIGHT]));\n    return vertical;\n  }\n\n  hasItems() {\n    return this.container.children[0].children.length > 0;\n  }\n\n  reflow(targetBox) {\n    const options = this.options;\n    const legendBox = targetBox.clone();\n\n    if (!this.hasItems()) {\n      this.box = legendBox;\n      return;\n    }\n\n    if (options.position === CUSTOM) {\n      this.containerCustomReflow(legendBox);\n      this.box = legendBox;\n    } else {\n      this.containerReflow(legendBox);\n    }\n\n    if (this.hasTitle()) {\n      this.title.reflow(new Box(this.container.box.x1, this.title.box.y1, this.container.box.x2, this.title.box.y2));\n    }\n  }\n\n  containerReflow(targetBox) {\n    const {\n      options,\n      container\n    } = this;\n    const {\n      position,\n      width,\n      height\n    } = options;\n    const pos = position === TOP || position === BOTTOM ? X : Y;\n    const vertical = this.isVertical();\n    const alignTarget = targetBox.clone();\n    let containerBox = targetBox.clone();\n\n    if (position === LEFT || position === RIGHT) {\n      containerBox.y1 = alignTarget.y1 = 0;\n    }\n\n    if (vertical && height) {\n      containerBox.y2 = containerBox.y1 + height;\n      containerBox.align(alignTarget, Y, container.options.vAlign);\n    } else if (!vertical && width) {\n      containerBox.x2 = containerBox.x1 + width;\n      containerBox.align(alignTarget, X, container.options.align);\n    }\n\n    container.reflow(containerBox);\n    containerBox = container.box;\n    const box = containerBox.clone();\n\n    if (options.offsetX || options.offsetY) {\n      containerBox.translate(options.offsetX, options.offsetY);\n      container.reflow(containerBox);\n    }\n\n    box[pos + 1] = targetBox[pos + 1];\n    box[pos + 2] = targetBox[pos + 2];\n    this.box = box;\n  }\n\n  containerCustomReflow(targetBox) {\n    const {\n      options,\n      container\n    } = this;\n    const {\n      offsetX,\n      offsetY,\n      width,\n      height\n    } = options;\n    const vertical = this.isVertical();\n    let containerBox = targetBox.clone();\n\n    if (vertical && height) {\n      containerBox.y2 = containerBox.y1 + height;\n    } else if (!vertical && width) {\n      containerBox.x2 = containerBox.x1 + width;\n    }\n\n    container.reflow(containerBox);\n    containerBox = container.box;\n    container.reflow(new Box(offsetX, offsetY, offsetX + containerBox.width(), offsetY + containerBox.height()));\n  }\n\n  renderVisual() {\n    if (this.hasItems()) {\n      super.renderVisual();\n    }\n  }\n\n  createLegendTitle(title) {\n    let titleOptions = deepExtend({}, {\n      color: BLACK,\n      position: TOP,\n      align: CENTER\n    }, title);\n    let text = titleOptions.text;\n\n    if (!title || title.visible === false) {\n      return;\n    }\n\n    if (defined(titleOptions) && titleOptions.visible) {\n      const labelTemplate = getTemplate(titleOptions);\n\n      if (labelTemplate) {\n        text = labelTemplate({\n          text: text\n        });\n      } else if (titleOptions.format) {\n        text = this.chartService.format.auto(titleOptions.format, text);\n      }\n    }\n\n    this.title = new TextBox(text, titleOptions);\n    this.createTitleLayout();\n    this.appendTitleLayoutContent();\n  }\n\n  createTitleLayout() {\n    this.layout = new FloatElement({\n      vertical: true,\n      wrap: false\n    });\n    this.container.append(this.layout);\n  }\n\n  hasTitle() {\n    return Boolean(this.options.title && this.options.title.visible !== false);\n  }\n\n  appendTitleLayoutContent() {\n    const options = this.options;\n\n    if (options.title.position === BOTTOM) {\n      this.layout.append(this.itemsContainer);\n      this.layout.append(this.title);\n    } else {\n      this.layout.append(this.title);\n      this.layout.append(this.itemsContainer);\n    }\n  }\n\n}\n\nsetDefaultOptions(Legend, {\n  position: RIGHT,\n  items: [],\n  offsetX: 0,\n  offsetY: 0,\n  margin: getSpacing(5),\n  padding: getSpacing(5),\n  border: {\n    color: BLACK,\n    width: 0\n  },\n  item: {\n    cursor: POINTER,\n    spacing: 6\n  },\n  spacing: 6,\n  background: \"\",\n  zIndex: 1,\n  markers: {\n    border: {\n      width: 0\n    },\n    width: 15,\n    height: 3,\n    type: \"rect\",\n    align: LEFT,\n    vAlign: CENTER\n  }\n});\nexport default Legend;","map":null,"metadata":{},"sourceType":"module"}