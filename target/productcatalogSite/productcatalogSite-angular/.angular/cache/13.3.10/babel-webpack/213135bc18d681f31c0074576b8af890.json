{"ast":null,"code":"var __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nvar __metadata = this && this.__metadata || function (k, v) {\n  if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\n};\n\nimport { WMLogger } from '@mobilize/logging';\nimport { Dictionary, Inject } from '../Application';\nimport { Constants, Events, Order } from '../Contract';\nimport { ErrorCodes, ExceptionHandlerClass } from '../System/Aop';\nvar METHODNOTIMPLEMENTED = 'Method not implemented.';\n\nvar ModelResolver = function () {\n  function ModelResolver(inject) {\n    if (inject === void 0) {\n      inject = null;\n    }\n\n    this.inject = inject;\n    this.inject = inject || Inject.Instance;\n    this.modelFactory = this.inject.resolve(Constants.ModelFactory);\n    this.event = this.inject.resolve(Constants.EventAggregator);\n    this.behaviors = new Dictionary();\n    this.requiredBehaviors = new Dictionary();\n    this.notifiers = new Array();\n    this.myIsSynchronizing = false;\n\n    this.PreProcessArray = function () {};\n\n    this.PostProcessArray = function () {};\n  }\n\n  ModelResolver.prototype.init = function (buffer) {\n    this.buffer = buffer;\n  };\n\n  ModelResolver.prototype.registerNotifier = function (notifier) {\n    if (this.notifiers.some(function (item) {\n      return item === notifier;\n    })) {\n      this.notifiers[this.notifiers.indexOf(notifier)] = notifier;\n    } else {\n      this.notifiers.push(notifier);\n    }\n  };\n\n  ModelResolver.prototype.registerBehavior = function (behavior, required) {\n    if (required === void 0) {\n      required = false;\n    }\n\n    if (!this.behaviors.containsKey(behavior.Order.toString())) {\n      this.behaviors.add(behavior.Order.toString(), []);\n    } else if (required) {\n      if (!this.requiredBehaviors.containsKey(behavior.Order.toString())) {\n        this.requiredBehaviors.add(behavior.Order.toString(), []);\n      }\n\n      this.addBehavior(behavior, this.requiredBehaviors);\n    }\n\n    this.addBehavior(behavior, this.behaviors);\n  };\n\n  ModelResolver.prototype.process = function () {\n    var behaviors = this.getBehaviors(this.behaviors);\n    this.applyBehaviors(behaviors, this.buffer.toArray());\n    this.resolveArrayDeltas(this.buffer.toArray().filter(function (model) {\n      return model['@arr'];\n    }));\n  };\n\n  ModelResolver.prototype.attachModels = function (modelDeltas) {\n    var _this = this;\n\n    this.myIsSynchronizing = true;\n    var models = this.propagateDeltas(modelDeltas);\n    var newModels = models[0];\n    var modifiedModels = models[1];\n    var stubModels = this.createMissingHierarchy(newModels);\n    newModels = newModels.concat(stubModels);\n    var behaviors = this.getBehaviors(this.behaviors);\n    this.applyBehaviors(behaviors, newModels);\n    var requiredBehaviors = this.getBehaviors(this.requiredBehaviors);\n    this.applyBehaviors(requiredBehaviors, modifiedModels);\n    this.resolveArrayDeltas(modelDeltas.filter(function (model) {\n      return model.UniqueID.length > 0 && _this.buffer.getModel(model.UniqueID)['@arr'];\n    }));\n    this.myIsSynchronizing = false;\n  };\n\n  ModelResolver.prototype.removeModels = function (models) {\n    var _this = this;\n\n    this.myIsSynchronizing = true;\n    models.forEach(function (model) {\n      _this.detachModel(model);\n\n      _this.buffer.deleteCascade(model.UniqueID);\n    });\n    this.myIsSynchronizing = false;\n  };\n\n  ModelResolver.prototype.switchIds = function (ids) {\n    var _this = this;\n\n    ids.forEach(function (item) {\n      return _this.buffer.switchIds(item[0], item[1]);\n    });\n  };\n\n  ModelResolver.prototype.isCoreSynchronizing = function () {\n    return this.myIsSynchronizing;\n  };\n\n  ModelResolver.prototype.detachModel = function (model) {\n    var parent = this.buffer.getParentByModel(model);\n\n    if (parent) {\n      parent.removeModel(model);\n    }\n  };\n\n  ModelResolver.prototype.getBehaviors = function (collection) {\n    if (collection === void 0) {\n      collection = this.behaviors;\n    }\n\n    return {\n      evt: this.notifiers,\n      ord: collection.value(Order.ORD.toString()) || [],\n      post: collection.value(Order.POST.toString()) || [],\n      pre: collection.value(Order.PRE.toString()) || []\n    };\n  };\n\n  ModelResolver.prototype.applyBehaviors = function (behaviors, models) {\n    var _this = this;\n\n    models.forEach(function (model) {\n      return _this.attachIsSynchronizingClient(model);\n    });\n    behaviors.pre.forEach(function (behavior) {\n      models.forEach(function (model) {\n        return _this.tryApplyBehaviors(behavior, model);\n      });\n    });\n    behaviors.ord.forEach(function (behavior) {\n      models.forEach(function (model) {\n        return _this.tryApplyBehaviors(behavior, model);\n      });\n    });\n    behaviors.post.forEach(function (behavior) {\n      models.forEach(function (model) {\n        return _this.tryApplyBehaviors(behavior, model);\n      });\n    });\n    behaviors.evt.forEach(function (notify) {\n      models.forEach(function (model) {\n        return _this.tryApplyBehaviors(notify, model);\n      });\n    });\n  };\n\n  ModelResolver.prototype.replaceBehavior = function (oldBehaviorName, behavior) {\n    var items = this.behaviors.value(behavior.Order.toString()) || [];\n\n    if (items.length > 0) {\n      var oldBehavior = items.filter(function (item) {\n        return item.constructor.name === oldBehaviorName;\n      });\n\n      if (oldBehavior != null) {\n        items[items.indexOf(oldBehavior[0])] = behavior;\n      } else {\n        this.registerBehavior(behavior);\n      }\n    } else {\n      this.registerBehavior(behavior);\n    }\n  };\n\n  ModelResolver.prototype.resolveAdded = function (addedModels) {\n    throw new Error(METHODNOTIMPLEMENTED);\n  };\n\n  ModelResolver.prototype.resolveChanged = function (changedModels) {\n    throw new Error(METHODNOTIMPLEMENTED);\n  };\n\n  ModelResolver.prototype.resolveRemoved = function (removedIds) {\n    var _this = this;\n\n    this.myIsSynchronizing = true;\n    removedIds.forEach(function (id) {\n      var model = _this.modelFactory.create({\n        UniqueID: id\n      });\n\n      if (model) {\n        _this.detachModel(model);\n\n        _this.buffer.deleteCascade(model.UniqueID);\n      }\n    });\n    this.myIsSynchronizing = false;\n  };\n\n  ModelResolver.prototype.removePendingActions = function () {\n    this.event.publish(Events.DeletePendingActions, this.buffer.removedModels);\n    this.buffer.removedModels = [];\n  };\n\n  ModelResolver.prototype.resolveValueTypeArray = function (models, Observable) {\n    var index;\n\n    for (index = 0; index < models.length; index++) {\n      Observable.addValueArray(Observable, models[index], index);\n    }\n\n    return index;\n  };\n\n  ModelResolver.prototype.resolveStateObjectAndSurrogateArray = function (models, Observable) {\n    var index;\n\n    for (index = 0; index < models.Count; index++) {\n      var element = this.buffer.getModel(models.uids[index]);\n\n      if (element !== null) {\n        Observable.addValueArray(Observable, element, index);\n      } else {\n        Observable.addValueArray(Observable, this.modelFactory.create({\n          UniqueID: ''\n        }), index);\n      }\n    }\n\n    return index;\n  };\n\n  ModelResolver.prototype.resolveObjectArray = function (models, Observable) {\n    var index;\n\n    for (index = 0; index < models.Count; index++) {\n      var element = this.buffer.getModel(models.uids[index]);\n\n      if (element !== null) {\n        Observable.addValueArray(Observable, element, index);\n      } else {\n        Observable.addValueArray(Observable, models.uids[index], index);\n      }\n    }\n\n    return index;\n  };\n\n  ModelResolver.prototype.resolveArrayDeltas = function (arrayDeltas) {\n    for (var _i = 0, arrayDeltas_1 = arrayDeltas; _i < arrayDeltas_1.length; _i++) {\n      var iter = arrayDeltas_1[_i];\n      this.PreProcessArray(iter);\n      var delta = iter;\n      var arrayObservable = this.buffer.getModel(delta.UniqueID);\n\n      if (!arrayObservable.isRoot() && !arrayObservable.isPointer) {\n        var index = void 0;\n\n        switch (delta['ltype']) {\n          case 1:\n            index = this.resolveValueTypeArray(delta['uids'], arrayObservable);\n            break;\n\n          case 2:\n          case 3:\n            index = this.resolveStateObjectAndSurrogateArray(delta, arrayObservable);\n            break;\n\n          case 4:\n            index = this.resolveObjectArray(delta, arrayObservable);\n            break;\n        }\n\n        if (delta['uids'].length < arrayObservable['length']) {\n          arrayObservable.removeValueAray(arrayObservable, index, arrayObservable['length'] - delta['uids'].length);\n        }\n      }\n\n      this.PostProcessArray(delta);\n\n      if (!arrayObservable.hasCircularReference()) {\n        arrayObservable.fireChange();\n      }\n    }\n  };\n\n  ModelResolver.prototype.addBehavior = function (behavior, collection) {\n    var items = collection.value(behavior.Order.toString());\n\n    if (items.some(function (item) {\n      return item === behavior;\n    })) {\n      items[items.indexOf(behavior)] = behavior;\n    } else {\n      items.push(behavior);\n    }\n  };\n\n  ModelResolver.prototype.propagateDeltas = function (modelDeltas) {\n    var _this = this;\n\n    var newModels = [];\n    var updateModels = [];\n    modelDeltas.forEach(function (item) {\n      if (item.UniqueID.length > 0) {\n        if (_this.buffer.exists(item)) {\n          _this.updateModel(item);\n\n          updateModels.push(item);\n        } else {\n          newModels.push(item);\n\n          _this.buffer.add(item);\n        }\n      }\n    });\n    return [newModels, updateModels];\n  };\n\n  ModelResolver.prototype.attachIsSynchronizingClient = function (model) {\n    var _this = this;\n\n    var item = this.buffer.getModel(model.UniqueID);\n\n    item.isCoreSynchronizing = function () {\n      return _this.isCoreSynchronizing();\n    };\n  };\n\n  ModelResolver.prototype.updateModel = function (item) {\n    var model = this.buffer.getModel(item.UniqueID);\n\n    if (model) {\n      model.updateModel(item);\n    } else {\n      WMLogger.instance().error('This models is not in the buffer. Please check the Backend response in the removed area.');\n    }\n  };\n\n  ModelResolver.prototype.tryApplyBehaviors = function (behavior, model) {\n    try {\n      behavior.apply(this.buffer.getModel(model.UniqueID), this.buffer);\n    } catch (e) {\n      WMLogger.instance().error(\"Error procesing an behavior \" + e + e.stack);\n    }\n  };\n\n  ModelResolver.prototype.createMissingHierarchy = function (models) {\n    var stubModels = [];\n\n    for (var _i = 0, models_1 = models; _i < models_1.length; _i++) {\n      var mod = models_1[_i];\n      var hierarchy = this.createMissingParent(mod, this.buffer);\n\n      if (hierarchy.length > 0) {\n        stubModels = stubModels.concat(hierarchy);\n      }\n    }\n\n    return stubModels;\n  };\n\n  ModelResolver.prototype.createMissingParent = function (model, buffer) {\n    var stubModels = [];\n\n    if (!model.isRoot()) {\n      var parent_1 = buffer.getParentByModel(model);\n\n      if (!parent_1) {\n        var parentData = {\n          UniqueID: model.parentName()\n        };\n\n        if (!isNaN(parseFloat(model.uniqueName()))) {\n          parentData['@arr'] = 1;\n        }\n\n        var parentStub = this.modelFactory.create(parentData);\n        stubModels.push(parentStub);\n        buffer.add(parentStub);\n        var hierarchy = this.createMissingParent(parentStub, buffer);\n\n        if (hierarchy.length > 0) {\n          stubModels = stubModels.concat(hierarchy);\n        }\n      }\n    }\n\n    return stubModels;\n  };\n\n  ModelResolver = __decorate([ExceptionHandlerClass(ErrorCodes.ClientCore), __metadata(\"design:paramtypes\", [Object])], ModelResolver);\n  return ModelResolver;\n}();\n\nexport { ModelResolver }; //# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTW9kZWxSZXNvbHZlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9Db3JlL01vZGVsUmVzb2x2ZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBa0JBLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUU3QyxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3BELE9BQU8sRUFDSCxTQUFTLEVBQUUsTUFBTSxFQUNzQyxLQUFLLEVBQy9ELE1BQU0sYUFBYSxDQUFDO0FBQ3JCLE9BQU8sRUFBRSxVQUFVLEVBQUUscUJBQXFCLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFbEUsSUFBTSxvQkFBb0IsR0FBRyx5QkFBeUIsQ0FBQztBQUd2RDtJQUNJLHVCQUFvQixNQUFzQjtRQUF0Qix1QkFBQSxFQUFBLGFBQXNCO1FBQXRCLFdBQU0sR0FBTixNQUFNLENBQWdCO1FBQ3RDLElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxJQUFJLE1BQU0sQ0FBQyxRQUFRLENBQUM7UUFDeEMsSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsWUFBWSxDQUFDLENBQUM7UUFDaEUsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsZUFBZSxDQUFDLENBQUM7UUFDNUQsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLFVBQVUsRUFBRSxDQUFDO1FBQ2xDLElBQUksQ0FBQyxpQkFBaUIsR0FBRyxJQUFJLFVBQVUsRUFBRSxDQUFDO1FBQzFDLElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxLQUFLLEVBQWtCLENBQUM7UUFDN0MsSUFBSSxDQUFDLGlCQUFpQixHQUFHLEtBQUssQ0FBQztRQUMvQixJQUFJLENBQUMsZUFBZSxHQUFHLGNBQVEsQ0FBQyxDQUFDO1FBQ2pDLElB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Q0QsSUFBTSxVQUFVLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLENBQUM7Z0JBQ3hELFVBQVUsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7Z0JBQzVCLE1BQU0sQ0FBQyxHQUFHLENBQUMsVUFBVSxDQUFDLENBQUM7Z0JBR3ZCLElBQU0sU0FBUyxHQUFHLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxVQUFVLEVBQUUsTUFBTSxDQUFDLENBQUM7Z0JBQy9ELElBQUksU0FBUyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7b0JBQ3RCLFVBQVUsR0FBRyxVQUFVLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDO2lCQUM3QzthQUNKO1NBQ0o7UUFDRCxPQUFPLFVBQVUsQ0FBQztJQUN0QixDQUFDO0lBaFVRLGFBQWE7UUFEekIscUJBQXFCLENBQUMsVUFBVSxDQUFDLFVBQVUsQ0FBQzs7T0FDaEMsYUFBYSxDQWlVekI7SUFBRCxvQkFBQztDQUFBLEFBalVELElBaVVDO1NBalVZLGFBQWEiLCJzb3VyY2VzQ29udGVudCI6WyIvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcclxuKiBDb3B5cmlnaHQgKEMpIE1vYmlsaXplLk5ldCA8aW5mb0Btb2JpbGl6ZS5uZXQ+IC0gQWxsIFJpZ2h0cyBSZXNlcnZlZFxyXG4qXHJcbiogVGhpcyBmaWxlIGlzIHBhcnQgb2YgdGhlIE1vYmlsaXplIEZyYW1ld29ya3MsIHdoaWNoIGlzXHJcbiogcHJvcHJpZXRhcnkgYW5kIGNvbmZpZGVudGlhbC5cclxuKlxyXG4qIE5PVElDRTogIEFsbCBpbmZvcm1hdGlvbiBjb250YWluZWQgaGVyZWluIGlzLCBhbmQgcmVtYWluc1xyXG4qIHRoZSBwcm9wZXJ0eSBvZiBNb2JpbGl6ZS5OZXQgQ29ycG9yYXRpb24uXHJcbiogVGhlIGludGVsbGVjdHVhbCBhbmQgdGVjaG5pY2FsIGNvbmNlcHRzIGNvbnRhaW5lZCBoZXJlaW4gYXJlXHJcbiogcHJvcHJpZXRhcnkgdG8gTW9iaWxpemUuTmV0IENvcnBvcmF0aW9uIGFuZCBtYXkgYmUgY292ZXJlZFxyXG4qIGJ5IFUuUy4gUGF0ZW50cywgYW5kIGFyZSBwcm90ZWN0ZWQgYnkgdHJhZGUgc2VjcmV0IG9yIGNvcHlyaWdodCBsYXcuXHJcbiogRGlzc2VtaW5hdGlvbiBvZiB0aGlzIGluZm9ybWF0aW9uIG9yIHJlcHJvZHVjdGlvbiBvZiB0aGlzIG1hdGVyaWFsXHJcbiogaXMgc3RyaWN0bHkgZm9yYmlkZGVuIHVubGVzcyBwcmlvciB3cml0dGVuIHBlcm1pc3Npb24gaXMgb2J0YWluZWRcclxuKiBmcm9tIE1vYmlsaXplLk5ldCBDb3Jwb3JhdGlvbi5cclxuKlxyXG4qIFRoaXMgZmlsZSBpcyBzdWJqZWN0IHRvIHRoZSB0ZXJtcyBhbmQgY29uZGl0aW9ucyBkZWZpbmVkIGluXHJcbiogZmlsZSAnTElDRU5TRS50eHQnLCB3aGljaCBpcyBwYXJ0IG9mIHRoaXMgc291cmNlIGNvZGUgcGFja2FnZS5cclxuKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXHJcbmltcG9ydCB7IFdNTG9nZ2VyIH0gZnJvbSAnQG1vYmlsaXplL2xvZ2dpbmcnO1xyXG5cclxuaW1wb3J0IHsgRGljdGlvbmFyeSwgSW5qZWN0IH0gZnJvbSAnLi4vQXBwbGljYXRpb24nO1xyXG5pbXBvcnQge1xyXG4gICAgQ29uc3RhbnRzLCBFdmVudHMsIElCdWZmZXIsIElDbGllbnRCZWhhdmlvciwgSURpY3Rpb25hcnksIElFdmVudEFnZ3JlZ2F0b3IsIElJbmplY3QsXHJcbiAgICBJTW9kZWwsIElNb2RlbEZhY3RvcnksIElNb2RlbE5vdGlmaWVyLCBJTW9kZWxSZXNvbHZlciwgT3JkZXJcclxufSBmcm9tICcuLi9Db250cmFjdCc7XHJcbmltcG9ydCB7IEVycm9yQ29kZXMsIEV4Y2VwdGlvbkhhbmRsZXJDbGFzcyB9IGZyb20gJy4uL1N5c3RlbS9Bb3AnO1xyXG5cclxuY29uc3QgTUVUSE9ETk9USU1QTEVNRU5URUQgPSAnTWV0aG9kIG5vdCBpbXBsZW1lbnRlZC4nO1xyXG5cclxuQEV4Y2VwdGlvbkhhbmRsZXJDbGFzcyhFcnJvckNvZGVzLkNsaWVudENvcmUpXHJcbmV4cG9ydCBjbGFzcyBNb2RlbFJlc29sdmVyIGltcGxlbWVudHMgSU1vZGVsUmVzb2x2ZXIge1xyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBpbmplY3Q6IElJbmplY3QgPSBudWxsKSB7XHJcbiAgICAgICAgdGhpcy5pbmplY3QgPSBpbmplY3QgfHwgSW5qZWN0Lkluc3RhbmNlO1xyXG4gICAgICAgIHRoaXMubW9kZWxGYWN0b3J5ID0gdGhpcy5pbmplY3QucmVzb2x2ZShDb25zdGFudHMuTW9kZWxGYWN0b3J5KTtcclxuICAgICAgICB0aGlzLmV2ZW50ID0gdGhpcy5pbmplY3QucmVzb2x2ZShDb25zdGFudHMuRXZlbnRBZ2dyZWdhdG9yKTtcclxuICAgICAgICB0aGlzLmJlaGF2aW9ycyA9IG5ldyBEaWN0aW9uYXJ5KCk7XHJcbiAgICAgICAgdGhpcy5yZXF1aXJlZEJlaGF2aW9ycyA9IG5ldyBEaWN0aW9uYXJ5KCk7XHJcbiAgICAgICAgdGhpcy5ub3RpZmllcnMgPSBuZXcgQXJyYXk8SU1vZGVsTm90aWZpZXI+KCk7XHJcbiAgICAgICAgdGhpcy5teUlzU3luY2hyb25pemluZyA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuUHJlUHJvY2Vzc0FycmF5ID0gKCkgPT4geyB9O1xyXG4gICAgICAgIHRoaXMuUG9zdFByb2Nlc3NBcnJheSA9ICgpID0+IHsgfTtcclxuICAgIH1cclxuICAgIHByb3RlY3RlZCBidWZmZXI6IElCdWZmZXI7XHJcbiAgICBwcm90ZWN0ZWQgbW9kZWxGYWN0b3J5OiBJTW9kZWxGYWN0b3J5O1xyXG4gICAgcHJvdGVjdGVkIFByZVByb2Nlc3NBcnJheTogKG1vZGVsOiBJTW9kZWwpID0+IHZvaWQ7XHJcbiAgICBwcm90ZWN0ZWQgUG9zdFByb2Nlc3NBcnJheTogKE1vZGVsOiBJTW9kZWwpID0+IHZvaWQ7XHJcbiAgICBwcm90ZWN0ZWQgZXZlbnQ6IElFdmVudEFnZ3JlZ2F0b3I7XHJcbiAgICBwcm90ZWN0ZWQgbXlJc1N5bmNocm9uaXppbmc6IGJvb2xlYW47XHJcbiAgICBwcml2YXRlIGJlaGF2aW9yczogSURpY3Rpb25hcnk7XHJcbiAgICBwcml2YXRlIHJlcXVpcmVkQmVoYXZpb3JzOiBJRGljdGlvbmFyeTtcclxuICAgIHByaXZhdGUgbm90aWZpZXJzOiBBcnJheTxJTW9kZWxOb3RpZmllcj47XHJcblxyXG4gICAgaW5pdChidWZmZXI6IElCdWZmZXIpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLmJ1ZmZlciA9IGJ1ZmZlcjtcclxuICAgIH1cclxuXHJcbiAgICByZWdpc3Rlck5vdGlmaWVyKG5vdGlmaWVyOiBJTW9kZWxOb3RpZmllcik6IHZvaWQge1xyXG4gICAgICAgIGlmICh0aGlzLm5vdGlmaWVycy5zb21lKGl0ZW0gPT4gaXRlbSA9PT0gbm90aWZpZXIpKSB7XHJcbiAgICAgICAgICAgIHRoaXMubm90aWZpZXJzW3RoaXMubm90aWZpZXJzLmluZGV4T2Yobm90aWZpZXIpXSA9IG5vdGlmaWVyO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMubm90aWZpZXJzLnB1c2gobm90aWZpZXIpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZWdpc3RlckJlaGF2aW9yKGJlaGF2aW9yOiBJQ2xpZW50QmVoYXZpb3IsIHJlcXVpcmVkID0gZmFsc2UpOiB2b2lkIHtcclxuICAgICAgICBpZiAoIXRoaXMuYmVoYXZpb3JzLmNvbnRhaW5zS2V5KGJlaGF2aW9yLk9yZGVyLnRvU3RyaW5nKCkpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuYmVoYXZpb3JzLmFkZChiZWhhdmlvci5PcmRlci50b1N0cmluZygpLCBbXSk7XHJcbiAgICAgICAgfSBlbHNlIGlmIChyZXF1aXJlZCkge1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMucmVxdWlyZWRCZWhhdmlvcnMuY29udGFpbnNLZXkoYmVoYXZpb3IuT3JkZXIudG9TdHJpbmcoKSkpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVxdWlyZWRCZWhhdmlvcnMuYWRkKGJlaGF2aW9yLk9yZGVyLnRvU3RyaW5nKCksIFtdKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLmFkZEJlaGF2aW9yKGJlaGF2aW9yLCB0aGlzLnJlcXVpcmVkQmVoYXZpb3JzKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5hZGRCZWhhdmlvcihiZWhhdmlvciwgdGhpcy5iZWhhdmlvcnMpO1xyXG4gICAgfVxyXG5cclxuICAgIHByb2Nlc3MoKTogdm9pZCB7XHJcbiAgICAgICAgY29uc3QgYmVoYXZpb3JzID0gdGhpcy5nZXRCZWhhdmlvcnModGhpcy5iZWhhdmlvcnMpO1xyXG4gICAgICAgIHRoaXMuYXBwbHlCZWhhdmlvcnMoYmVoYXZpb3JzLCB0aGlzLmJ1ZmZlci50b0FycmF5KCkpO1xyXG4gICAgICAgIHRoaXMucmVzb2x2ZUFycmF5RGVsdGFzKHRoaXMuYnVmZmVyLnRvQXJyYXkoKS5maWx0ZXIobW9kZWwgPT4gbW9kZWxbJ0BhcnInXSkpO1xyXG4gICAgfVxyXG5cclxuICAgIGF0dGFjaE1vZGVscyhtb2RlbERlbHRhczogQXJyYXk8SU1vZGVsPik6IHZvaWQge1xyXG4gICAgICAgIHRoaXMubXlJc1N5bmNocm9uaXppbmcgPSB0cnVlO1xyXG4gICAgICAgIGNvbnN0IG1vZGVscyA9IHRoaXMucHJvcGFnYXRlRGVsdGFzKG1vZGVsRGVsdGFzKTtcclxuICAgICAgICBsZXQgbmV3TW9kZWxzID0gbW9kZWxzWzBdO1xyXG4gICAgICAgIGNvbnN0IG1vZGlmaWVkTW9kZWxzID0gbW9kZWxzWzFdO1xyXG4gICAgICAgIGNvbnN0IHN0dWJNb2RlbHMgPSB0aGlzLmNyZWF0ZU1pc3NpbmdIaWVyYXJjaHkobmV3TW9kZWxzKTtcclxuICAgICAgICBuZXdNb2RlbHMgPSBuZXdNb2RlbHMuY29uY2F0KHN0dWJNb2RlbHMpO1xyXG4gICAgICAgIGNvbnN0IGJlaGF2aW9ycyA9IHRoaXMuZ2V0QmVoYXZpb3JzKHRoaXMuYmVoYXZpb3JzKTtcclxuICAgICAgICB0aGlzLmFwcGx5QmVoYXZpb3JzKGJlaGF2aW9ycywgbmV3TW9kZWxzKTtcclxuICAgICAgICAvLyBBcHBseSByZXF1aXJlZCBiZWhhdmlvcnNcclxuICAgICAgICBjb25zdCByZXF1aXJlZEJlaGF2aW9ycyA9IHRoaXMuZ2V0QmVoYXZpb3JzKHRoaXMucmVxdWlyZWRCZWhhdmlvcnMpO1xyXG4gICAgICAgIHRoaXMuYXBwbHlCZWhhdmlvcnMocmVxdWlyZWRCZWhhdmlvcnMsIG1vZGlmaWVkTW9kZWxzKTtcclxuICAgICAgICB0aGlzLnJlc29sdmVBcnJheURlbHRhcyhtb2RlbERlbHRhcy5maWx0ZXIobW9kZWwgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gbW9kZWwuVW5pcXVlSUQubGVuZ3RoID4gMCAmJiB0aGlzLmJ1ZmZlci5nZXRNb2RlbChtb2RlbC5VbmlxdWVJRClbJ0BhcnInXTtcclxuICAgICAgICB9KSk7XHJcblxyXG4gICAgICAgIHRoaXMubXlJc1N5bmNocm9uaXppbmcgPSBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICByZW1vdmVNb2RlbHMobW9kZWxzOiBBcnJheTxJTW9kZWw+KTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5teUlzU3luY2hyb25pemluZyA9IHRydWU7XHJcbiAgICAgICAgbW9kZWxzLmZvckVhY2gobW9kZWwgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmRldGFjaE1vZGVsKG1vZGVsKTtcclxuICAgICAgICAgICAgdGhpcy5idWZmZXIuZGVsZXRlQ2FzY2FkZShtb2RlbC5VbmlxdWVJRCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5teUlzU3luY2hyb25pemluZyA9IGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIHN3aXRjaElkcyhpZHM6IEFycmF5PEFycmF5PHN0cmluZz4+KTogdm9pZCB7XHJcbiAgICAgICAgaWRzLmZvckVhY2goaXRlbSA9PiB0aGlzLmJ1ZmZlci5zd2l0Y2hJZHMoaXRlbVswXSwgaXRlbVsxXSkpO1xyXG4gICAgfVxyXG5cclxuICAgIGlzQ29yZVN5bmNocm9uaXppbmcoKTogYm9vbGVhbiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMubXlJc1N5bmNocm9uaXppbmc7XHJcbiAgICB9XHJcblxyXG4gICAgZGV0YWNoTW9kZWwobW9kZWw6IElNb2RlbCk6IHZvaWQge1xyXG4gICAgICAgIGNvbnN0IHBhcmVudCA9IHRoaXMuYnVmZmVyLmdldFBhcmVudEJ5TW9kZWwobW9kZWwpO1xyXG4gICAgICAgIGlmIChwYXJlbnQpIHtcclxuICAgICAgICAgICAgcGFyZW50LnJlbW92ZU1vZGVsKG1vZGVsKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0QmVoYXZpb3JzKGNvbGxlY3Rpb246IElEaWN0aW9uYXJ5ID0gdGhpcy5iZWhhdmlvcnMpOiBhbnkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGV2dDogdGhpcy5ub3RpZmllcnMsXHJcbiAgICAgICAgICAgIG9yZDogY29sbGVjdGlvbi52YWx1ZShPcmRlci5PUkQudG9TdHJpbmcoKSkgfHwgW10sXHJcbiAgICAgICAgICAgIHBvc3Q6IGNvbGxlY3Rpb24udmFsdWUoT3JkZXIuUE9TVC50b1N0cmluZygpKSB8fCBbXSxcclxuICAgICAgICAgICAgcHJlOiBjb2xsZWN0aW9uLnZhbHVlKE9yZGVyLlBSRS50b1N0cmluZygpKSB8fCBbXVxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgYXBwbHlCZWhhdmlvcnMoYmVoYXZpb3JzOiBhbnksIG1vZGVsczogQXJyYXk8SU1vZGVsPik6IGFueSB7XHJcbiAgICAgICAgbW9kZWxzLmZvckVhY2goKG1vZGVsKSA9PiB0aGlzLmF0dGFjaElzU3luY2hyb25pemluZ0NsaWVudChtb2RlbCkpO1xyXG5cclxuICAgICAgICBiZWhhdmlvcnMucHJlLmZvckVhY2goKGJlaGF2aW9yKSA9PiB7XHJcbiAgICAgICAgICAgIG1vZGVscy5mb3JFYWNoKChtb2RlbCkgPT4gdGhpcy50cnlBcHBseUJlaGF2aW9ycyhiZWhhdmlvciwgbW9kZWwpKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBiZWhhdmlvcnMub3JkLmZvckVhY2goKGJlaGF2aW9yKSA9PiB7XHJcbiAgICAgICAgICAgIG1vZGVscy5mb3JFYWNoKChtb2RlbCkgPT4gdGhpcy50cnlBcHBseUJlaGF2aW9ycyhiZWhhdmlvciwgbW9kZWwpKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBiZWhhdmlvcnMucG9zdC5mb3JFYWNoKChiZWhhdmlvcikgPT4ge1xyXG4gICAgICAgICAgICBtb2RlbHMuZm9yRWFjaCgobW9kZWwpID0+IHRoaXMudHJ5QXBwbHlCZWhhdmlvcnMoYmVoYXZpb3IsIG1vZGVsKSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgYmVoYXZpb3JzLmV2dC5mb3JFYWNoKChub3RpZnkpID0+IHtcclxuICAgICAgICAgICAgbW9kZWxzLmZvckVhY2goKG1vZGVsKSA9PiB0aGlzLnRyeUFwcGx5QmVoYXZpb3JzKG5vdGlmeSwgbW9kZWwpKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICByZXBsYWNlQmVoYXZpb3Iob2xkQmVoYXZpb3JOYW1lOiBzdHJpbmcsIGJlaGF2aW9yOiBJQ2xpZW50QmVoYXZpb3IpOiB2b2lkIHtcclxuICAgICAgICBjb25zdCBpdGVtczogQXJyYXk8SUNsaWVudEJlaGF2aW9yPiA9IHRoaXMuYmVoYXZpb3JzLnZhbHVlKGJlaGF2aW9yLk9yZGVyLnRvU3RyaW5nKCkpIHx8IFtdO1xyXG4gICAgICAgIGlmIChpdGVtcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG9sZEJlaGF2aW9yID0gaXRlbXMuZmlsdGVyKGl0ZW0gPT4gKGl0ZW0uY29uc3RydWN0b3IgYXMgYW55KS5uYW1lID09PSBvbGRCZWhhdmlvck5hbWUpO1xyXG4gICAgICAgICAgICBpZiAob2xkQmVoYXZpb3IgIT0gbnVsbCkgeyAvLyBzb21lKGl0ZW0gPT4gaXRlbS5jb25zdHJ1Y3Rvci5uYW1lID09PSBvbGRCZWhhdmlvck5hbWUpKSB7XHJcbiAgICAgICAgICAgICAgICBpdGVtc1tpdGVtcy5pbmRleE9mKG9sZEJlaGF2aW9yWzBdKV0gPSBiZWhhdmlvcjtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVnaXN0ZXJCZWhhdmlvcihiZWhhdmlvcik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLnJlZ2lzdGVyQmVoYXZpb3IoYmVoYXZpb3IpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZXNvbHZlQWRkZWQoYWRkZWRNb2RlbHM6IGFueVtdKTogdm9pZCB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKE1FVEhPRE5PVElNUExFTUVOVEVEKTtcclxuICAgIH1cclxuICAgIHJlc29sdmVDaGFuZ2VkKGNoYW5nZWRNb2RlbHM6IGFueVtdKTogdm9pZCB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKE1FVEhPRE5PVElNUExFTUVOVEVEKTtcclxuICAgIH1cclxuXHJcbiAgICByZXNvbHZlUmVtb3ZlZChyZW1vdmVkSWRzOiBBcnJheTxzdHJpbmc+KTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5teUlzU3luY2hyb25pemluZyA9IHRydWU7XHJcbiAgICAgICAgcmVtb3ZlZElkcy5mb3JFYWNoKGlkID0+IHtcclxuICAgICAgICAgICAgY29uc3QgbW9kZWwgPSB0aGlzLm1vZGVsRmFjdG9yeS5jcmVhdGUoeyBVbmlxdWVJRDogaWQgfSk7XHJcbiAgICAgICAgICAgIGlmIChtb2RlbCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kZXRhY2hNb2RlbChtb2RlbCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmJ1ZmZlci5kZWxldGVDYXNjYWRlKG1vZGVsLlVuaXF1ZUlEKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMubXlJc1N5bmNocm9uaXppbmcgPSBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFJlbW92ZSBhbnkgcGVuZGluZyBhY3Rpb24gcmVsYXRlZCB0byBhIGRlbGV0ZWRcclxuICAgICAqIGNvbnRyb2wsIGNvbXBvbmVudCBvciB2aWV3LlxyXG4gICAgICovXHJcbiAgICByZW1vdmVQZW5kaW5nQWN0aW9ucygpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLmV2ZW50LnB1Ymxpc2goRXZlbnRzLkRlbGV0ZVBlbmRpbmdBY3Rpb25zLCB0aGlzLmJ1ZmZlci5yZW1vdmVkTW9kZWxzKTtcclxuICAgICAgICB0aGlzLmJ1ZmZlci5yZW1vdmVkTW9kZWxzID0gW107XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSByZXNvbHZlVmFsdWVUeXBlQXJyYXkobW9kZWxzOiBhbnksIE9ic2VydmFibGU6IElNb2RlbCk6IG51bWJlciB7XHJcbiAgICAgICAgbGV0IGluZGV4O1xyXG4gICAgICAgIGZvciAoaW5kZXggPSAwOyBpbmRleCA8IG1vZGVscy5sZW5ndGg7IGluZGV4KyspIHtcclxuICAgICAgICAgICAgT2JzZXJ2YWJsZS5hZGRWYWx1ZUFycmF5KE9ic2VydmFibGUsIG1vZGVsc1tpbmRleF0sIGluZGV4KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGluZGV4O1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgcmVzb2x2ZVN0YXRlT2JqZWN0QW5kU3Vycm9nYXRlQXJyYXkobW9kZWxzOiBhbnksIE9ic2VydmFibGU6IElNb2RlbCk6IG51bWJlciB7XHJcbiAgICAgICAgbGV0IGluZGV4O1xyXG4gICAgICAgIGZvciAoaW5kZXggPSAwOyBpbmRleCA8IG1vZGVscy5Db3VudDsgaW5kZXgrKykge1xyXG4gICAgICAgICAgICBjb25zdCBlbGVtZW50ID0gdGhpcy5idWZmZXIuZ2V0TW9kZWwobW9kZWxzLnVpZHNbaW5kZXhdKTtcclxuICAgICAgICAgICAgLy8gaWYgZWxlbWVudCBpcyBub3QgbnVsbCwgdGhlbiB0aGlzIG1lYW5zIHRoYXQgaXQgaXMgYW4gT2JzZXJ2YWJsZU9iamVjdFxyXG4gICAgICAgICAgICBpZiAoZWxlbWVudCAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgT2JzZXJ2YWJsZS5hZGRWYWx1ZUFycmF5KE9ic2VydmFibGUsIGVsZW1lbnQsIGluZGV4KTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIC8vIElmIGVsZW1lbnQgaXMgbnVsbCwgdGhlbiB0aGlzIGlzIG1heWJlIGFuIG9iamVjdCB0aGF0IHdhcyBtYXJrZWQgYXNcclxuICAgICAgICAgICAgICAgIC8vIElEZXBlbmRlbnRNb2RlbCBhdCB0aGUgc2VydmVyIHNpZGUsIHNvIHRoZSBvYmplY3QgaXMgbm90IHBhc3NlZCB0byB0aGUgY2xpZW50IHNpZGUuXHJcbiAgICAgICAgICAgICAgICBPYnNlcnZhYmxlLmFkZFZhbHVlQXJyYXkoT2JzZXJ2YWJsZSwgdGhpcy5tb2RlbEZhY3RvcnkuY3JlYXRlKHsgVW5pcXVlSUQ6ICcnIH0pLCBpbmRleCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGluZGV4O1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgcmVzb2x2ZU9iamVjdEFycmF5KG1vZGVsczogYW55LCBPYnNlcnZhYmxlOiBJTW9kZWwpOiBudW1iZXIge1xyXG4gICAgICAgIGxldCBpbmRleDtcclxuICAgICAgICBmb3IgKGluZGV4ID0gMDsgaW5kZXggPCBtb2RlbHMuQ291bnQ7IGluZGV4KyspIHtcclxuICAgICAgICAgICAgY29uc3QgZWxlbWVudCA9IHRoaXMuYnVmZmVyLmdldE1vZGVsKG1vZGVscy51aWRzW2luZGV4XSk7XHJcbiAgICAgICAgICAgIC8vIGlmIGVsZW1lbnQgaXMgbm90IG51bGwsIHRoZW4gdGhpcyBtZWFucyB0aGF0IGl0IGlzIGFuIE9ic2VydmFibGVPYmplY3RcclxuICAgICAgICAgICAgaWYgKGVsZW1lbnQgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIE9ic2VydmFibGUuYWRkVmFsdWVBcnJheShPYnNlcnZhYmxlLCBlbGVtZW50LCBpbmRleCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvLyBUaGlzIGlzIGEgVmFsdWUgVHlwZVxyXG4gICAgICAgICAgICAgICAgT2JzZXJ2YWJsZS5hZGRWYWx1ZUFycmF5KE9ic2VydmFibGUsIG1vZGVscy51aWRzW2luZGV4XSwgaW5kZXgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBpbmRleDtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHJlc29sdmVBcnJheURlbHRhcyhhcnJheURlbHRhczogQXJyYXk8SU1vZGVsPik6IHZvaWQge1xyXG4gICAgICAgIGZvciAoY29uc3QgaXRlciBvZiBhcnJheURlbHRhcykge1xyXG4gICAgICAgICAgICB0aGlzLlByZVByb2Nlc3NBcnJheShpdGVyKTtcclxuICAgICAgICAgICAgY29uc3QgZGVsdGEgPSBpdGVyO1xyXG4gICAgICAgICAgICBjb25zdCBhcnJheU9ic2VydmFibGUgPSB0aGlzLmJ1ZmZlci5nZXRNb2RlbChkZWx0YS5VbmlxdWVJRCk7XHJcbiAgICAgICAgICAgIGlmICghYXJyYXlPYnNlcnZhYmxlLmlzUm9vdCgpICYmICFhcnJheU9ic2VydmFibGUuaXNQb2ludGVyKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgaW5kZXg7XHJcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKGRlbHRhWydsdHlwZSddKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLyogVmFsdWVUeXBlcyBhcnJheSovXHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbmRleCA9IHRoaXMucmVzb2x2ZVZhbHVlVHlwZUFycmF5KGRlbHRhWyd1aWRzJ10sIGFycmF5T2JzZXJ2YWJsZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIC8qIElTdGF0ZU9iamVjdCBhbmQgU3Vycm9nYXRlIGFycmF5ICovXHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAyOlxyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXggPSB0aGlzLnJlc29sdmVTdGF0ZU9iamVjdEFuZFN1cnJvZ2F0ZUFycmF5KGRlbHRhLCBhcnJheU9ic2VydmFibGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAvKiBPYmplY3QgYXJyYXkgKi9cclxuICAgICAgICAgICAgICAgICAgICBjYXNlIDQ6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4ID0gdGhpcy5yZXNvbHZlT2JqZWN0QXJyYXkoZGVsdGEsIGFycmF5T2JzZXJ2YWJsZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgLyogUmVtb3ZlIGl0ZW1zIGFmdGVyIHRoZSBsZW5ndGggb2YgbmV3IEFycmF5LiAqL1xyXG4gICAgICAgICAgICAgICAgaWYgKGRlbHRhWyd1aWRzJ10ubGVuZ3RoIDwgYXJyYXlPYnNlcnZhYmxlWydsZW5ndGgnXSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGFycmF5T2JzZXJ2YWJsZS5yZW1vdmVWYWx1ZUFyYXkoYXJyYXlPYnNlcnZhYmxlLCBpbmRleCwgYXJyYXlPYnNlcnZhYmxlWydsZW5ndGgnXSAtIGRlbHRhWyd1aWRzJ10ubGVuZ3RoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLlBvc3RQcm9jZXNzQXJyYXkoZGVsdGEpO1xyXG4gICAgICAgICAgICBpZiAoIWFycmF5T2JzZXJ2YWJsZS5oYXNDaXJjdWxhclJlZmVyZW5jZSgpKSB7XHJcbiAgICAgICAgICAgICAgICBhcnJheU9ic2VydmFibGUuZmlyZUNoYW5nZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgYWRkQmVoYXZpb3IoYmVoYXZpb3I6IElDbGllbnRCZWhhdmlvciwgY29sbGVjdGlvbjogSURpY3Rpb25hcnkpOiB2b2lkIHtcclxuICAgICAgICBjb25zdCBpdGVtczogQXJyYXk8SUNsaWVudEJlaGF2aW9yPiA9IGNvbGxlY3Rpb24udmFsdWUoYmVoYXZpb3IuT3JkZXIudG9TdHJpbmcoKSk7XHJcbiAgICAgICAgaWYgKGl0ZW1zLnNvbWUoaXRlbSA9PiBpdGVtID09PSBiZWhhdmlvcikpIHtcclxuICAgICAgICAgICAgaXRlbXNbaXRlbXMuaW5kZXhPZihiZWhhdmlvcildID0gYmVoYXZpb3I7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaXRlbXMucHVzaChiZWhhdmlvcik7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgcHJvcGFnYXRlRGVsdGFzKG1vZGVsRGVsdGFzOiBBcnJheTxJTW9kZWw+KTogQXJyYXk8QXJyYXk8SU1vZGVsPj4ge1xyXG4gICAgICAgIGNvbnN0IG5ld01vZGVscyA9IFtdO1xyXG4gICAgICAgIGNvbnN0IHVwZGF0ZU1vZGVscyA9IFtdO1xyXG4gICAgICAgIG1vZGVsRGVsdGFzLmZvckVhY2goaXRlbSA9PiB7XHJcbiAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSB0aGUgaXRlbSBoYXMgYSBVbmlxdWVJRCwgb3RoZXJ3aXNlIHRoZSB1cGRhdGUgcHJvY2VzcyBjcmFzaGVzXHJcbiAgICAgICAgICAgIGlmIChpdGVtLlVuaXF1ZUlELmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmJ1ZmZlci5leGlzdHMoaXRlbSkpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZU1vZGVsKGl0ZW0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZU1vZGVscy5wdXNoKGl0ZW0pO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBuZXdNb2RlbHMucHVzaChpdGVtKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmJ1ZmZlci5hZGQoaXRlbSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gW25ld01vZGVscywgdXBkYXRlTW9kZWxzXTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGF0dGFjaElzU3luY2hyb25pemluZ0NsaWVudChtb2RlbDogSU1vZGVsKTogdm9pZCB7XHJcbiAgICAgICAgY29uc3QgaXRlbSA9IHRoaXMuYnVmZmVyLmdldE1vZGVsKG1vZGVsLlVuaXF1ZUlEKTtcclxuICAgICAgICBpdGVtLmlzQ29yZVN5bmNocm9uaXppbmcgPSAoKSA9PiB0aGlzLmlzQ29yZVN5bmNocm9uaXppbmcoKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHVwZGF0ZU1vZGVsKGl0ZW06IElNb2RlbCk6IHZvaWQge1xyXG4gICAgICAgIGNvbnN0IG1vZGVsID0gdGhpcy5idWZmZXIuZ2V0TW9kZWwoaXRlbS5VbmlxdWVJRCk7XHJcbiAgICAgICAgaWYgKG1vZGVsKSB7XHJcbiAgICAgICAgICAgIG1vZGVsLnVwZGF0ZU1vZGVsKGl0ZW0pO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1jb25zb2xlXHJcbiAgICAgICAgICAgIFdNTG9nZ2VyLmluc3RhbmNlKCkuZXJyb3IoJ1RoaXMgbW9kZWxzIGlzIG5vdCBpbiB0aGUgYnVmZmVyLiBQbGVhc2UgY2hlY2sgdGhlIEJhY2tlbmQgcmVzcG9uc2UgaW4gdGhlIHJlbW92ZWQgYXJlYS4nKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSB0cnlBcHBseUJlaGF2aW9ycyhiZWhhdmlvcjogYW55LCBtb2RlbDogSU1vZGVsKTogdm9pZCB7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgYmVoYXZpb3IuYXBwbHkodGhpcy5idWZmZXIuZ2V0TW9kZWwobW9kZWwuVW5pcXVlSUQpLCB0aGlzLmJ1ZmZlcik7XHJcbiAgICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8tY29uc29sZVxyXG4gICAgICAgICAgICBXTUxvZ2dlci5pbnN0YW5jZSgpLmVycm9yKGBFcnJvciBwcm9jZXNpbmcgYW4gYmVoYXZpb3IgJHtlfSR7ZS5zdGFja31gKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBjcmVhdGVNaXNzaW5nSGllcmFyY2h5KG1vZGVsczogQXJyYXk8SU1vZGVsPik6IEFycmF5PElNb2RlbD4ge1xyXG4gICAgICAgIGxldCBzdHViTW9kZWxzID0gW107XHJcbiAgICAgICAgZm9yIChjb25zdCBtb2Qgb2YgbW9kZWxzKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGhpZXJhcmNoeSA9IHRoaXMuY3JlYXRlTWlzc2luZ1BhcmVudChtb2QsIHRoaXMuYnVmZmVyKTtcclxuICAgICAgICAgICAgaWYgKGhpZXJhcmNoeS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICBzdHViTW9kZWxzID0gc3R1Yk1vZGVscy5jb25jYXQoaGllcmFyY2h5KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gc3R1Yk1vZGVscztcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGNyZWF0ZU1pc3NpbmdQYXJlbnQobW9kZWw6IElNb2RlbCwgYnVmZmVyOiBJQnVmZmVyKTogQXJyYXk8SU1vZGVsPiB7XHJcbiAgICAgICAgbGV0IHN0dWJNb2RlbHMgPSBbXTtcclxuICAgICAgICBpZiAoIW1vZGVsLmlzUm9vdCgpKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHBhcmVudCA9IGJ1ZmZlci5nZXRQYXJlbnRCeU1vZGVsKG1vZGVsKTtcclxuICAgICAgICAgICAgaWYgKCFwYXJlbnQpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHBhcmVudERhdGEgPSB7IFVuaXF1ZUlEOiBtb2RlbC5wYXJlbnROYW1lKCkgfTtcclxuICAgICAgICAgICAgICAgIC8vIGNoZWNrIGlmIHRoZSBuYW1lIGlzIGEgbnVtYmVyLCB3aGljaCBtZWFucyB0aGUgcGFyZW50IGlzIGFuIGFycmF5XHJcbiAgICAgICAgICAgICAgICBpZiAoIWlzTmFOKHBhcnNlRmxvYXQobW9kZWwudW5pcXVlTmFtZSgpKSkpIHtcclxuICAgICAgICAgICAgICAgICAgICBwYXJlbnREYXRhWydAYXJyJ10gPSAxO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgY29uc3QgcGFyZW50U3R1YiA9IHRoaXMubW9kZWxGYWN0b3J5LmNyZWF0ZShwYXJlbnREYXRhKTtcclxuICAgICAgICAgICAgICAgIHN0dWJNb2RlbHMucHVzaChwYXJlbnRTdHViKTtcclxuICAgICAgICAgICAgICAgIGJ1ZmZlci5hZGQocGFyZW50U3R1Yik7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gbWFrZSBzdXJlIHRoZSByZXN0IG9mIHRoZSBoaWVyYXJjaHkgaXMgcG9wdWxhdGVkXHJcbiAgICAgICAgICAgICAgICBjb25zdCBoaWVyYXJjaHkgPSB0aGlzLmNyZWF0ZU1pc3NpbmdQYXJlbnQocGFyZW50U3R1YiwgYnVmZmVyKTtcclxuICAgICAgICAgICAgICAgIGlmIChoaWVyYXJjaHkubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHN0dWJNb2RlbHMgPSBzdHViTW9kZWxzLmNvbmNhdChoaWVyYXJjaHkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBzdHViTW9kZWxzO1xyXG4gICAgfVxyXG59XHJcbiJdfQ==","map":null,"metadata":{},"sourceType":"module"}