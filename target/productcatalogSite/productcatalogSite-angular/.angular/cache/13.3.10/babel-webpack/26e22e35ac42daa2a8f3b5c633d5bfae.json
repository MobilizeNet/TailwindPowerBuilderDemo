{"ast":null,"code":"var __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nimport { WMLogger } from '@mobilize/logging';\nimport { ModelResolver } from '../../Core';\nimport { ErrorCodes, ExceptionHandlerClass } from '../../System/Aop';\n\nvar ModelResolverV5 = function (_super) {\n  __extends(ModelResolverV5, _super);\n\n  function ModelResolverV5() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  ModelResolverV5.prototype.resolveAdded = function (projections) {\n    var _this = this;\n\n    this.myIsSynchronizing = true;\n\n    if (projections) {\n      var newModels = projections.map(function (projection) {\n        return _this.modelFactory.create(projection);\n      });\n      this.addNewModels(newModels);\n      var behaviors = this.getBehaviors();\n      this.applyBehaviors(behaviors, newModels);\n    }\n\n    this.myIsSynchronizing = false;\n  };\n\n  ModelResolverV5.prototype.resolveChanged = function (projections) {\n    this.myIsSynchronizing = true;\n\n    if (projections) {\n      var updatedModels = this.updateModels(projections);\n      var behaviors = this.getBehaviors();\n      behaviors.evt = [];\n      this.applyBehaviors(behaviors, updatedModels);\n    }\n\n    this.myIsSynchronizing = false;\n  };\n\n  ModelResolverV5.prototype.resolveRemoved = function (removedIds) {\n    var _this = this;\n\n    this.myIsSynchronizing = true;\n\n    if (removedIds) {\n      removedIds.forEach(function (id) {\n        _this.detachReference(id);\n\n        _this.buffer.deleteCascade(id);\n      });\n    }\n\n    this.myIsSynchronizing = false;\n  };\n\n  ModelResolverV5.prototype.addNewModels = function (newModels) {\n    var _this = this;\n\n    newModels.forEach(function (item) {\n      if (item.UniqueID && item.UniqueID.length > 0) {\n        if (!_this.buffer.exists(item)) {\n          _this.buffer.add(item);\n        } else {\n          WMLogger.instance().error(\"New model with Id \" + item.UniqueID + \" already exists.\");\n        }\n      }\n    });\n  };\n\n  ModelResolverV5.prototype.updateModels = function (projections) {\n    var updatedModels = [];\n\n    for (var _i = 0, projections_1 = projections; _i < projections_1.length; _i++) {\n      var projection = projections_1[_i];\n      var model = this.buffer.getModel(projection.Id);\n\n      if (model) {\n        model.updateModel(projection);\n\n        if (projection.EventChanges) {\n          model.eventChanges = projection.EventChanges;\n        }\n\n        if (projection.Style) {\n          model.stylePivot = projection.Style;\n        }\n\n        updatedModels.push(model);\n      } else {\n        console.error('This models is not in the buffer. Please check the Backend response in the removed area.');\n      }\n    }\n\n    return updatedModels;\n  };\n\n  ModelResolverV5.prototype.detachReference = function (id) {\n    var model = this.buffer.getModel(id);\n\n    if (model) {\n      var parentRefs = model.referencedBy;\n\n      for (var parentId in parentRefs) {\n        if (parentRefs.hasOwnProperty(parentId)) {\n          var parent_1 = this.buffer.getModel(parentId);\n\n          if (parent_1) {\n            parent_1.removeReference(parentRefs[parentId]);\n          }\n        }\n      }\n    }\n  };\n\n  ModelResolverV5 = __decorate([ExceptionHandlerClass(ErrorCodes.ClientCore)], ModelResolverV5);\n  return ModelResolverV5;\n}(ModelResolver);\n\nexport { ModelResolverV5 }; //# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTW9kZWxSZXNvbHZlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy92NS9Db3JlL01vZGVsUmVzb2x2ZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBa0JBLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUc3QyxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sWUFBWSxDQUFDO0FBQzNDLE9BQU8sRUFBRSxVQUFVLEVBQUUscUJBQXFCLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUdyRTtJQUFxQyxtQ0FBYTtJQUFsRDs7SUF5R0EsQ0FBQztJQXBHRyxzQ0FBWSxHQUFaLFVBQWEsV0FBb0M7UUFBakQsaUJBWUM7UUFYRyxJQUFJLENBQUMsaUJBQWlCLEdBQUcsSUFBSSxDQUFDO1FBRTlCLElBQUksV0FBVyxFQUFFO1lBQ2IsSUFBTSxTQUFTLEdBQUcsV0FBVyxDQUFDLEdBQUcsQ0FBQyxVQUFDLFVBQVUsSUFBSyxPQUFBLEtBQUksQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxFQUFwQyxDQUFvQyxDQUFDLENBQUM7WUFDeEYsSUFBSSxDQUFDLFlBQVksQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUU3QixJQUFNLFNBQVMsR0FBRyxJQUFJLENBQUMsWUFBWSxFQUFFLENBQUM7WUFDdEMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxTQUFTLEVBQUUsU0FBUyxDQUFDLENBQUM7U0FDN0M7UUFFRCxJQUFJLENBQUMsaUJBQWlCLEdBQUcsS0FBSyxDQUFDO0lBQ25DLENBQUM7SUFNRCx3Q0FBYyxHQUFkLFVBQWUsV0FBb0M7UUFDL0MsSUFBSSxDQUFDLGlCQUFpQixHQUFHLElBQUksQ0FBQztRQUU5QixJQUFJLFdBQVcsRUFBRTtZQUNiLElBQU0sYUFBYSxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsV0FBVyxDQUFDLENBQUM7WUFDckQsSUFBTSxTQUFTLEdBQUcs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QUFVLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQztxQkFDaEQ7aUJBQ0o7YUFDSjtTQUNKO0lBQ0wsQ0FBQztJQXhHUSxlQUFlO1FBRDNCLHFCQUFxQixDQUFDLFVBQVUsQ0FBQyxVQUFVLENBQUM7T0FDaEMsZUFBZSxDQXlHM0I7SUFBRCxzQkFBQztDQUFBLEFBekdELENBQXFDLGFBQWEsR0F5R2pEO1NBekdZLGVBQWUiLCJzb3VyY2VzQ29udGVudCI6WyIvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcclxuKiBDb3B5cmlnaHQgKEMpIE1vYmlsaXplLk5ldCA8aW5mb0Btb2JpbGl6ZS5uZXQ+IC0gQWxsIFJpZ2h0cyBSZXNlcnZlZFxyXG4qXHJcbiogVGhpcyBmaWxlIGlzIHBhcnQgb2YgdGhlIE1vYmlsaXplIEZyYW1ld29ya3MsIHdoaWNoIGlzXHJcbiogcHJvcHJpZXRhcnkgYW5kIGNvbmZpZGVudGlhbC5cclxuKlxyXG4qIE5PVElDRTogIEFsbCBpbmZvcm1hdGlvbiBjb250YWluZWQgaGVyZWluIGlzLCBhbmQgcmVtYWluc1xyXG4qIHRoZSBwcm9wZXJ0eSBvZiBNb2JpbGl6ZS5OZXQgQ29ycG9yYXRpb24uXHJcbiogVGhlIGludGVsbGVjdHVhbCBhbmQgdGVjaG5pY2FsIGNvbmNlcHRzIGNvbnRhaW5lZCBoZXJlaW4gYXJlXHJcbiogcHJvcHJpZXRhcnkgdG8gTW9iaWxpemUuTmV0IENvcnBvcmF0aW9uIGFuZCBtYXkgYmUgY292ZXJlZFxyXG4qIGJ5IFUuUy4gUGF0ZW50cywgYW5kIGFyZSBwcm90ZWN0ZWQgYnkgdHJhZGUgc2VjcmV0IG9yIGNvcHlyaWdodCBsYXcuXHJcbiogRGlzc2VtaW5hdGlvbiBvZiB0aGlzIGluZm9ybWF0aW9uIG9yIHJlcHJvZHVjdGlvbiBvZiB0aGlzIG1hdGVyaWFsXHJcbiogaXMgc3RyaWN0bHkgZm9yYmlkZGVuIHVubGVzcyBwcmlvciB3cml0dGVuIHBlcm1pc3Npb24gaXMgb2J0YWluZWRcclxuKiBmcm9tIE1vYmlsaXplLk5ldCBDb3Jwb3JhdGlvbi5cclxuKlxyXG4qIFRoaXMgZmlsZSBpcyBzdWJqZWN0IHRvIHRoZSB0ZXJtcyBhbmQgY29uZGl0aW9ucyBkZWZpbmVkIGluXHJcbiogZmlsZSAnTElDRU5TRS50eHQnLCB3aGljaCBpcyBwYXJ0IG9mIHRoaXMgc291cmNlIGNvZGUgcGFja2FnZS5cclxuKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXHJcbmltcG9ydCB7IFdNTG9nZ2VyIH0gZnJvbSAnQG1vYmlsaXplL2xvZ2dpbmcnO1xyXG5cclxuaW1wb3J0IHsgRXZlbnRzLCBJTW9kZWwsIElNb2RlbFByb2plY3Rpb24sIElNb2RlbFJlc29sdmVyIH0gZnJvbSAnLi4vLi4vQ29udHJhY3QnO1xyXG5pbXBvcnQgeyBNb2RlbFJlc29sdmVyIH0gZnJvbSAnLi4vLi4vQ29yZSc7XHJcbmltcG9ydCB7IEVycm9yQ29kZXMsIEV4Y2VwdGlvbkhhbmRsZXJDbGFzcyB9IGZyb20gJy4uLy4uL1N5c3RlbS9Bb3AnO1xyXG5cclxuQEV4Y2VwdGlvbkhhbmRsZXJDbGFzcyhFcnJvckNvZGVzLkNsaWVudENvcmUpXHJcbmV4cG9ydCBjbGFzcyBNb2RlbFJlc29sdmVyVjUgZXh0ZW5kcyBNb2RlbFJlc29sdmVyIGltcGxlbWVudHMgSU1vZGVsUmVzb2x2ZXIge1xyXG4gICAgLyoqXHJcbiAgICAgKiBBZGRzIHRoZSBuZXcgbW9kZWxzIHRvIHRoZSBsb2NhbCByZXBvc2l0b3J5XHJcbiAgICAgKiBAcGFyYW0gbmV3TW9kZWxzIFRoZSBuZXcgbW9kZWxzIHRvIGFkZFxyXG4gICAgICovXHJcbiAgICByZXNvbHZlQWRkZWQocHJvamVjdGlvbnM6IEFycmF5PElNb2RlbFByb2plY3Rpb24+KTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5teUlzU3luY2hyb25pemluZyA9IHRydWU7XHJcblxyXG4gICAgICAgIGlmIChwcm9qZWN0aW9ucykge1xyXG4gICAgICAgICAgICBjb25zdCBuZXdNb2RlbHMgPSBwcm9qZWN0aW9ucy5tYXAoKHByb2plY3Rpb24pID0+IHRoaXMubW9kZWxGYWN0b3J5LmNyZWF0ZShwcm9qZWN0aW9uKSk7XHJcbiAgICAgICAgICAgIHRoaXMuYWRkTmV3TW9kZWxzKG5ld01vZGVscyk7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBiZWhhdmlvcnMgPSB0aGlzLmdldEJlaGF2aW9ycygpO1xyXG4gICAgICAgICAgICB0aGlzLmFwcGx5QmVoYXZpb3JzKGJlaGF2aW9ycywgbmV3TW9kZWxzKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMubXlJc1N5bmNocm9uaXppbmcgPSBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFVwZGF0ZXMgZXhpc3RpbmcgbW9kZWxzIHdpdGggdGhlIHJlY2VpdmVkIGNoYW5nZXNcclxuICAgICAqIEBwYXJhbSBjaGFuZ2VkOiBUaGUgbGlzdCBvZiBjaGFuZ2VkIG1vZGVscyBhbmQgdGhlaXIgdXBkYXRlZCB2YWx1ZXNcclxuICAgICAqL1xyXG4gICAgcmVzb2x2ZUNoYW5nZWQocHJvamVjdGlvbnM6IEFycmF5PElNb2RlbFByb2plY3Rpb24+KTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5teUlzU3luY2hyb25pemluZyA9IHRydWU7XHJcblxyXG4gICAgICAgIGlmIChwcm9qZWN0aW9ucykge1xyXG4gICAgICAgICAgICBjb25zdCB1cGRhdGVkTW9kZWxzID0gdGhpcy51cGRhdGVNb2RlbHMocHJvamVjdGlvbnMpO1xyXG4gICAgICAgICAgICBjb25zdCBiZWhhdmlvcnMgPSB0aGlzLmdldEJlaGF2aW9ycygpO1xyXG4gICAgICAgICAgICBiZWhhdmlvcnMuZXZ0ID0gW107IC8vIERvbid0IHJlLWFwcGx5IG5vdGlmaWVycyBmb3IgZXhpc3RpbmcgbW9kZWxzXHJcbiAgICAgICAgICAgIHRoaXMuYXBwbHlCZWhhdmlvcnMoYmVoYXZpb3JzLCB1cGRhdGVkTW9kZWxzKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMubXlJc1N5bmNocm9uaXppbmcgPSBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFJlbW92ZXMgdGhlIG1vZGVscyBmcm9tIHRoZSBjdXJyZW50IGNvbGxlY3Rpb25zIG9mIG1vZGVsc1xyXG4gICAgICogQHBhcmFtIHJlbW92ZWRJZHMgVGhlIGxpc3Qgb2YgaWRzIG9mIHRoZSByZW1vdmVkIG1vZGVsc1xyXG4gICAgICovXHJcbiAgICByZXNvbHZlUmVtb3ZlZChyZW1vdmVkSWRzOiBBcnJheTxzdHJpbmc+KTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5teUlzU3luY2hyb25pemluZyA9IHRydWU7XHJcbiAgICAgICAgaWYgKHJlbW92ZWRJZHMpIHtcclxuICAgICAgICAgICAgcmVtb3ZlZElkcy5mb3JFYWNoKGlkID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGV0YWNoUmVmZXJlbmNlKGlkKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuYnVmZmVyLmRlbGV0ZUNhc2NhZGUoaWQpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5teUlzU3luY2hyb25pemluZyA9IGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIHByb3RlY3RlZCBhZGROZXdNb2RlbHMobmV3TW9kZWxzOiBBcnJheTxhbnk+KTogdm9pZCB7XHJcbiAgICAgICAgbmV3TW9kZWxzLmZvckVhY2goaXRlbSA9PiB7XHJcbiAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSB0aGUgaXRlbSBoYXMgYSBVbmlxdWVJRCwgb3RoZXJ3aXNlIHRoZSB1cGRhdGUgcHJvY2VzcyBjcmFzaGVzXHJcbiAgICAgICAgICAgIGlmIChpdGVtLlVuaXF1ZUlEICYmIGl0ZW0uVW5pcXVlSUQubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLmJ1ZmZlci5leGlzdHMoaXRlbSkpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmJ1ZmZlci5hZGQoaXRlbSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIFRPRE86IHByb3Blcmx5IGhhbmRsZSBlcnJvclxyXG4gICAgICAgICAgICAgICAgICAgIFdNTG9nZ2VyLmluc3RhbmNlKCkuZXJyb3IoYE5ldyBtb2RlbCB3aXRoIElkICR7aXRlbS5VbmlxdWVJRH0gYWxyZWFkeSBleGlzdHMuYCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwcm90ZWN0ZWQgdXBkYXRlTW9kZWxzKHByb2plY3Rpb25zOiBBcnJheTxJTW9kZWxQcm9qZWN0aW9uPik6IEFycmF5PElNb2RlbD4ge1xyXG4gICAgICAgIGNvbnN0IHVwZGF0ZWRNb2RlbHMgPSBbXTtcclxuICAgICAgICBmb3IgKGNvbnN0IHByb2plY3Rpb24gb2YgcHJvamVjdGlvbnMpIHtcclxuICAgICAgICAgICAgY29uc3QgbW9kZWwgPSB0aGlzLmJ1ZmZlci5nZXRNb2RlbChwcm9qZWN0aW9uLklkKTtcclxuICAgICAgICAgICAgaWYgKG1vZGVsKSB7XHJcbiAgICAgICAgICAgICAgICBtb2RlbC51cGRhdGVNb2RlbChwcm9qZWN0aW9uIGFzIGFueSk7XHJcbiAgICAgICAgICAgICAgICBpZiAocHJvamVjdGlvbi5FdmVudENoYW5nZXMpIHtcclxuICAgICAgICAgICAgICAgICAgICBtb2RlbC5ldmVudENoYW5nZXMgPSBwcm9qZWN0aW9uLkV2ZW50Q2hhbmdlcztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChwcm9qZWN0aW9uLlN0eWxlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbW9kZWwuc3R5bGVQaXZvdCA9IHByb2plY3Rpb24uU3R5bGU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB1cGRhdGVkTW9kZWxzLnB1c2gobW9kZWwpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLWNvbnNvbGVcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1RoaXMgbW9kZWxzIGlzIG5vdCBpbiB0aGUgYnVmZmVyLiBQbGVhc2UgY2hlY2sgdGhlIEJhY2tlbmQgcmVzcG9uc2UgaW4gdGhlIHJlbW92ZWQgYXJlYS4nKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdXBkYXRlZE1vZGVscztcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFJlbW92ZXMgdGhlIHJlZmVyZW5jZSBmcm9tIG90aGVyIG1vZGVscyB0byB0aGlzIG1vZGVsXHJcbiAgICAgKiBAcGFyYW0gaWRcclxuICAgICAqL1xyXG4gICAgcHJvdGVjdGVkIGRldGFjaFJlZmVyZW5jZShpZDogc3RyaW5nKTogdm9pZCB7XHJcbiAgICAgICAgY29uc3QgbW9kZWwgPSB0aGlzLmJ1ZmZlci5nZXRNb2RlbChpZCk7XHJcbiAgICAgICAgaWYgKG1vZGVsKSB7IC8vIFZlcmlmeSBpZiBtb2RlbCBpcyBub3QgYWxyZWFkeSByZW1vdmVkXHJcbiAgICAgICAgICAgIGNvbnN0IHBhcmVudFJlZnMgPSBtb2RlbC5yZWZlcmVuY2VkQnk7XHJcblxyXG4gICAgICAgICAgICBmb3IgKGNvbnN0IHBhcmVudElkIGluIHBhcmVudFJlZnMpIHtcclxuICAgICAgICAgICAgICAgIGlmIChwYXJlbnRSZWZzLmhhc093blByb3BlcnR5KHBhcmVudElkKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHBhcmVudCA9IHRoaXMuYnVmZmVyLmdldE1vZGVsKHBhcmVudElkKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocGFyZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudC5yZW1vdmVSZWZlcmVuY2UocGFyZW50UmVmc1twYXJlbnRJZF0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iXX0=","map":null,"metadata":{},"sourceType":"module"}