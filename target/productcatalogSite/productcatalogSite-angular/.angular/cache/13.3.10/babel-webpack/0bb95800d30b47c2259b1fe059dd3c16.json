{"ast":null,"code":"var __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nvar __metadata = this && this.__metadata || function (k, v) {\n  if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\n};\n\nimport { ActionService, ActionState, PendingEvent } from '../../Application';\nimport { ExceptionHandler } from '../../System';\nimport { ServerAction } from '../Server';\n\nvar ActionServiceV5 = function (_super) {\n  __extends(ActionServiceV5, _super);\n\n  function ActionServiceV5() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  ActionServiceV5.prototype.send = function (action, includeDirty) {\n    var request = this.requestBuilder.create(action);\n\n    if (action.requestConfig.includeDirty) {\n      request.Changed = this.changeBuffer.getChanges();\n    }\n\n    if (request.Actions) {\n      request.Actions = request.Actions.concat(this.buildCommandGenerators().map(function (c) {\n        return new ServerAction(c.receiverId, c.command, c.data);\n      }));\n    }\n\n    if (action.highPriority) {\n      this.pendingEvents.unshift(new PendingEvent(action, request));\n    } else {\n      this.pendingEvents.push(new PendingEvent(action, request));\n    }\n\n    this.sendActions();\n  };\n\n  ActionServiceV5.prototype.sendActions = function () {\n    var _this = this;\n\n    if (this.state === ActionState.Idle) {\n      this.state = ActionState.Sending;\n      var event_1 = this.pendingEvents.shift();\n      var data = JSON.stringify(event_1.request);\n      this.http.post(this.urlResolver.resolveUrl(event_1.action), data, function (response) {\n        _this.handleResponse(event_1.action, response);\n      }, event_1.action.requestConfig, event_1.action.serverEvent);\n    }\n  };\n\n  ActionServiceV5.prototype.sendImmediateAction = function (action, includeDirty) {\n    var _this = this;\n\n    var request = this.requestBuilder.create(action);\n\n    if (action.requestConfig.includeDirty) {\n      request.Changed = this.changeBuffer.getChanges();\n    }\n\n    if (request.Actions) {\n      request.Actions = request.Actions.concat(this.buildCommandGenerators().map(function (c) {\n        return new ServerAction(c.receiverId, c.command, c.data);\n      }));\n    }\n\n    var event = new PendingEvent(action, request);\n    var data = JSON.stringify(event.request);\n    this.http.post(this.urlResolver.resolveUrl(event.action), data, function (response) {\n      _this.handleResponse(event.action, response);\n    }, event.action.requestConfig, event.action.serverEvent);\n  };\n\n  __decorate([ExceptionHandler('onException'), __metadata(\"design:type\", Function), __metadata(\"design:paramtypes\", []), __metadata(\"design:returntype\", void 0)], ActionServiceV5.prototype, \"sendActions\", null);\n\n  __decorate([ExceptionHandler('onException'), __metadata(\"design:type\", Function), __metadata(\"design:paramtypes\", [Object, Boolean]), __metadata(\"design:returntype\", void 0)], ActionServiceV5.prototype, \"sendImmediateAction\", null);\n\n  return ActionServiceV5;\n}(ActionService);\n\nexport { ActionServiceV5 }; //# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQWN0aW9uU2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy92NS9BcHBsaWNhdGlvbi9BY3Rpb25TZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQWtCQSxPQUFPLEVBQUUsYUFBYSxFQUFFLFdBQVcsRUFBRSxZQUFZLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUU3RSxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxjQUFjLENBQUM7QUFDaEQsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLFdBQVcsQ0FBQztBQUd6QztJQUFxQyxtQ0FBYTtJQUFsRDs7SUE4REEsQ0FBQztJQTVERyw4QkFBSSxHQUFKLFVBQUssTUFBb0IsRUFBRSxZQUFzQjtRQUM3QyxJQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUNuRCxJQUFJLE1BQU0sQ0FBQyxhQUFhLENBQUMsWUFBWSxFQUFFO1lBQ25DLE9BQU8sQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxVQUFVLEVBQUUsQ0FBQztTQUNwRDtRQUNELElBQUksT0FBTyxDQUFDLE9BQU8sRUFBRTtZQUNqQixPQUFPLENBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxzQkFBc0IsRUFBRSxDQUFDLEdBQUcsQ0FBQyxVQUFDLENBQUM7Z0JBQ3pFLE9BQUEsSUFBSSxZQUFZLENBQUMsQ0FBQyxDQUFDLFVBQVUsRUFBRSxDQUFDLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUM7WUFBakQsQ0FBaUQsQ0FBQyxDQUFDLENBQUM7U0FDM0Q7UUFDRCxJQUFJLE1BQU0sQ0FBQyxZQUFZLEVBQUU7WUFDckIsSUFBSSxDQUFDLGFBQWEsQ0FBQyxPQUFPLENBQUMsSUFBSSxZQUFZLENBQUMsTUFBTSxFQUFFLE9BQU8sQ0FBQyxDQUFDLENBQUM7U0FDakU7YUFBTTtZQUNILElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLElBQUksWUFBWSxDQUFDLE1BQU0sRUFBRSxPQUFPLENBQUMsQ0FBQyxDQUFDO1NBQzlEO1FBQ0QsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDO0lBQ3ZCLENBQUM7SUFHRCxxQ0FBVyxHQUFYO1FBREEsaUJBYUM7UUFYRyxJQUFJLElBQUksQ0FBQyxLQUFLLEtBQUssV0FBVyxDQUFDLElBQUksRUFBRTtZQUNqQyxJQUFJLENBQUMsS0FBSyxHQUFHLFdBQVcsQ0FBQyxPQUFPLENBQUM7WUFDakMsSUFBTSxPQUFLLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxLQUFLLEVBQUUsQ0FBQztZQUN6QyxJQUFNLElBQUksR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLE9BQUssQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUMzQyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FDVixJQUFJLENBQUMsV0FBVyxDQUFDLFVBQVUsQ0FBQyxPQUFLLENBQUMsTUFBTSxDQUFDLEVBQ3pDLElBQUksRUFDSixVQUFDLFFBQVEsSUFBTyxLQUFJLENBQUMsY0FBYyxDQUFDLE9BQUssQ0FBQyxNQUFNLEVBQUUsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQzlELE9BQUssQ0FBQyxNQUFNLENBQUMsYUFBYSxFQUMxQixPQUFLLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1NBQ2pDO0lBQ0wsQ0FBQztJQVdELDZDQUFtQixHQUFuQixVQUFvQixNQUFvQixFQUFFLFlBQXNCO1FBRGhFLGlCQWtCQztRQWhCRyxJQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUNuRCxJQUFJLE1BQU0sQ0FBQyxhQUFhLENBQUMsWUFBWSxFQUFFO1lBQ25DLE9BQU8sQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxVQUFVLEVBQUUsQ0FBQztTQUNwRDtRQUNELElBQUksT0FBTyxDQUFDLE9BQU8sRUFBRTtZQUNqQixPQUFPLENBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxzQkFBc0IsRUFBRSxDQUFDLEdBQUcsQ0FBQyxVQUFDLENBQUM7Z0JBQ3pFLE9BQUEsSUFBSSxZQUFZLENBQUMsQ0FBQyxDQUFDLFVBQVUsRUFBRSxDQUFDLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUM7WUFBakQsQ0FBaUQsQ0FBQyxDQUFDLENBQUM7U0FDM0Q7UUFDRCxJQUFNLEtBQUssR0FBRyxJQUFJLFlBQVksQ0FBQyxNQUFNLEVBQUUsT0FBTyxDQUFDLENBQUM7UUFDaEQsSUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDM0MsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQ1YsSUFBSSxDQUFDLFdBQVcsQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxFQUN6QyxJQUFJLEVBQ0osVUFBQyxRQUFRLElBQU8sS0FBSSxDQUFDLGNBQWMsQ0FBQyxLQUFLLENBQUMsTUFBTSxFQUFFLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUM5RCxLQUFLLENBQUMsTUFBTSxDQUFDLGFBQWEsRUFDMUIsS0FBSyxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQztJQUNsQyxDQUFDO0lBeENEO1FBREMsZ0JBQWdCLENBQUMsYUFBYSxDQUFDOzs7O3NEQWEvQjtJQVdEO1FBREMsZ0JBQWdCLENBQUMsYUFBYSxDQUFDOzs7OzhEQWtCL0I7SUFFTCxzQkFBQztDQUFBLEFBOURELENBQXFDLGFBQWEsR0E4RGpEO1NBOURZLGVBQWUiLCJzb3VyY2VzQ29udGVudCI6WyIvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcclxuKiBDb3B5cmlnaHQgKEMpIE1vYmlsaXplLk5ldCA8aW5mb0Btb2JpbGl6ZS5uZXQ+IC0gQWxsIFJpZ2h0cyBSZXNlcnZlZFxyXG4qXHJcbiogVGhpcyBmaWxlIGlzIHBhcnQgb2YgdGhlIE1vYmlsaXplIEZyYW1ld29ya3MsIHdoaWNoIGlzXHJcbiogcHJvcHJpZXRhcnkgYW5kIGNvbmZpZGVudGlhbC5cclxuKlxyXG4qIE5PVElDRTogIEFsbCBpbmZvcm1hdGlvbiBjb250YWluZWQgaGVyZWluIGlzLCBhbmQgcmVtYWluc1xyXG4qIHRoZSBwcm9wZXJ0eSBvZiBNb2JpbGl6ZS5OZXQgQ29ycG9yYXRpb24uXHJcbiogVGhlIGludGVsbGVjdHVhbCBhbmQgdGVjaG5pY2FsIGNvbmNlcHRzIGNvbnRhaW5lZCBoZXJlaW4gYXJlXHJcbiogcHJvcHJpZXRhcnkgdG8gTW9iaWxpemUuTmV0IENvcnBvcmF0aW9uIGFuZCBtYXkgYmUgY292ZXJlZFxyXG4qIGJ5IFUuUy4gUGF0ZW50cywgYW5kIGFyZSBwcm90ZWN0ZWQgYnkgdHJhZGUgc2VjcmV0IG9yIGNvcHlyaWdodCBsYXcuXHJcbiogRGlzc2VtaW5hdGlvbiBvZiB0aGlzIGluZm9ybWF0aW9uIG9yIHJlcHJvZHVjdGlvbiBvZiB0aGlzIG1hdGVyaWFsXHJcbiogaXMgc3RyaWN0bHkgZm9yYmlkZGVuIHVubGVzcyBwcmlvciB3cml0dGVuIHBlcm1pc3Npb24gaXMgb2J0YWluZWRcclxuKiBmcm9tIE1vYmlsaXplLk5ldCBDb3Jwb3JhdGlvbi5cclxuKlxyXG4qIFRoaXMgZmlsZSBpcyBzdWJqZWN0IHRvIHRoZSB0ZXJtcyBhbmQgY29uZGl0aW9ucyBkZWZpbmVkIGluXHJcbiogZmlsZSAnTElDRU5TRS50eHQnLCB3aGljaCBpcyBwYXJ0IG9mIHRoaXMgc291cmNlIGNvZGUgcGFja2FnZS5cclxuKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXHJcbmltcG9ydCB7IEFjdGlvblNlcnZpY2UsIEFjdGlvblN0YXRlLCBQZW5kaW5nRXZlbnQgfSBmcm9tICcuLi8uLi9BcHBsaWNhdGlvbic7XHJcbmltcG9ydCB7IENvbnN0YW50cywgSUFjdGlvbk1vZGVsIH0gZnJvbSAnLi4vLi4vQ29udHJhY3QnO1xyXG5pbXBvcnQgeyBFeGNlcHRpb25IYW5kbGVyIH0gZnJvbSAnLi4vLi4vU3lzdGVtJztcclxuaW1wb3J0IHsgU2VydmVyQWN0aW9uIH0gZnJvbSAnLi4vU2VydmVyJztcclxuaW1wb3J0IHsgVmlld01hbmFnZXJWNSB9IGZyb20gJy4uL1VJJztcclxuXHJcbmV4cG9ydCBjbGFzcyBBY3Rpb25TZXJ2aWNlVjUgZXh0ZW5kcyBBY3Rpb25TZXJ2aWNlIHtcclxuXHJcbiAgICBzZW5kKGFjdGlvbjogSUFjdGlvbk1vZGVsLCBpbmNsdWRlRGlydHk/OiBib29sZWFuKTogdm9pZCB7XHJcbiAgICAgICAgY29uc3QgcmVxdWVzdCA9IHRoaXMucmVxdWVzdEJ1aWxkZXIuY3JlYXRlKGFjdGlvbik7XHJcbiAgICAgICAgaWYgKGFjdGlvbi5yZXF1ZXN0Q29uZmlnLmluY2x1ZGVEaXJ0eSkge1xyXG4gICAgICAgICAgICByZXF1ZXN0LkNoYW5nZWQgPSB0aGlzLmNoYW5nZUJ1ZmZlci5nZXRDaGFuZ2VzKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChyZXF1ZXN0LkFjdGlvbnMpIHtcclxuICAgICAgICAgICAgcmVxdWVzdC5BY3Rpb25zID0gcmVxdWVzdC5BY3Rpb25zLmNvbmNhdCh0aGlzLmJ1aWxkQ29tbWFuZEdlbmVyYXRvcnMoKS5tYXAoKGMpID0+XHJcbiAgICAgICAgICAgICAgICBuZXcgU2VydmVyQWN0aW9uKGMucmVjZWl2ZXJJZCwgYy5jb21tYW5kLCBjLmRhdGEpKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChhY3Rpb24uaGlnaFByaW9yaXR5KSB7XHJcbiAgICAgICAgICAgIHRoaXMucGVuZGluZ0V2ZW50cy51bnNoaWZ0KG5ldyBQZW5kaW5nRXZlbnQoYWN0aW9uLCByZXF1ZXN0KSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5wZW5kaW5nRXZlbnRzLnB1c2gobmV3IFBlbmRpbmdFdmVudChhY3Rpb24sIHJlcXVlc3QpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5zZW5kQWN0aW9ucygpO1xyXG4gICAgfVxyXG5cclxuICAgIEBFeGNlcHRpb25IYW5kbGVyKCdvbkV4Y2VwdGlvbicpXHJcbiAgICBzZW5kQWN0aW9ucygpOiB2b2lkIHtcclxuICAgICAgICBpZiAodGhpcy5zdGF0ZSA9PT0gQWN0aW9uU3RhdGUuSWRsZSkge1xyXG4gICAgICAgICAgICB0aGlzLnN0YXRlID0gQWN0aW9uU3RhdGUuU2VuZGluZztcclxuICAgICAgICAgICAgY29uc3QgZXZlbnQgPSB0aGlzLnBlbmRpbmdFdmVudHMuc2hpZnQoKTtcclxuICAgICAgICAgICAgY29uc3QgZGF0YSA9IEpTT04uc3RyaW5naWZ5KGV2ZW50LnJlcXVlc3QpO1xyXG4gICAgICAgICAgICB0aGlzLmh0dHAucG9zdChcclxuICAgICAgICAgICAgICAgIHRoaXMudXJsUmVzb2x2ZXIucmVzb2x2ZVVybChldmVudC5hY3Rpb24pLFxyXG4gICAgICAgICAgICAgICAgZGF0YSxcclxuICAgICAgICAgICAgICAgIChyZXNwb25zZSkgPT4geyB0aGlzLmhhbmRsZVJlc3BvbnNlKGV2ZW50LmFjdGlvbiwgcmVzcG9uc2UpOyB9LFxyXG4gICAgICAgICAgICAgICAgZXZlbnQuYWN0aW9uLnJlcXVlc3RDb25maWcsXHJcbiAgICAgICAgICAgICAgICBldmVudC5hY3Rpb24uc2VydmVyRXZlbnQpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEZ1bmN0aW9uIHRvIHNlbmQgYW4gYWN0aW9uIHdpdGhvdXQgd2FpdGluZyBmb3IgcmVzcG9uc2Ugb2YgcHJldmlvdXMgYWN0aW9uc1xyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSB7SUFjdGlvbk1vZGVsfSBhY3Rpb25cclxuICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2luY2x1ZGVEaXJ0eV1cclxuICAgICAqIEBtZW1iZXJvZiBBY3Rpb25TZXJ2aWNlVjVcclxuICAgICAqL1xyXG4gICAgLyogYzggaWdub3JlIHN0YXJ0ICovXHJcbiAgICBARXhjZXB0aW9uSGFuZGxlcignb25FeGNlcHRpb24nKVxyXG4gICAgc2VuZEltbWVkaWF0ZUFjdGlvbihhY3Rpb246IElBY3Rpb25Nb2RlbCwgaW5jbHVkZURpcnR5PzogYm9vbGVhbik6IHZvaWQge1xyXG4gICAgICAgIGNvbnN0IHJlcXVlc3QgPSB0aGlzLnJlcXVlc3RCdWlsZGVyLmNyZWF0ZShhY3Rpb24pO1xyXG4gICAgICAgIGlmIChhY3Rpb24ucmVxdWVzdENvbmZpZy5pbmNsdWRlRGlydHkpIHtcclxuICAgICAgICAgICAgcmVxdWVzdC5DaGFuZ2VkID0gdGhpcy5jaGFuZ2VCdWZmZXIuZ2V0Q2hhbmdlcygpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAocmVxdWVzdC5BY3Rpb25zKSB7XHJcbiAgICAgICAgICAgIHJlcXVlc3QuQWN0aW9ucyA9IHJlcXVlc3QuQWN0aW9ucy5jb25jYXQodGhpcy5idWlsZENvbW1hbmRHZW5lcmF0b3JzKCkubWFwKChjKSA9PlxyXG4gICAgICAgICAgICAgICAgbmV3IFNlcnZlckFjdGlvbihjLnJlY2VpdmVySWQsIGMuY29tbWFuZCwgYy5kYXRhKSkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBldmVudCA9IG5ldyBQZW5kaW5nRXZlbnQoYWN0aW9uLCByZXF1ZXN0KTtcclxuICAgICAgICBjb25zdCBkYXRhID0gSlNPTi5zdHJpbmdpZnkoZXZlbnQucmVxdWVzdCk7XHJcbiAgICAgICAgdGhpcy5odHRwLnBvc3QoXHJcbiAgICAgICAgICAgIHRoaXMudXJsUmVzb2x2ZXIucmVzb2x2ZVVybChldmVudC5hY3Rpb24pLFxyXG4gICAgICAgICAgICBkYXRhLFxyXG4gICAgICAgICAgICAocmVzcG9uc2UpID0+IHsgdGhpcy5oYW5kbGVSZXNwb25zZShldmVudC5hY3Rpb24sIHJlc3BvbnNlKTsgfSxcclxuICAgICAgICAgICAgZXZlbnQuYWN0aW9uLnJlcXVlc3RDb25maWcsXHJcbiAgICAgICAgICAgIGV2ZW50LmFjdGlvbi5zZXJ2ZXJFdmVudCk7XHJcbiAgICB9XHJcbiAgICAvKiBjOCBpZ25vcmUgc3RvcCAqL1xyXG59XHJcbiJdfQ==","map":null,"metadata":{},"sourceType":"module"}